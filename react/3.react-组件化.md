# react 组件化开发



### 组件的定义方式

#### 函数组件

```jsx
function App() {
  return (
    <div className="App">
      函数式组件
    </div>
  );
}
```

- 不具备this(组件实例)
- 没有内部状态（state）
- 不具有生命周期



#### 类组件

```jsx
import { Component } from "react";

class App extends Component {
  constructor(props) {
    super(props)
    this.state = {
      message: '类组件的内部状态'
    }
  }
  render() {
    return (
      <h2>{this.state.message}</h2>
    )
  }
}
```

- 类组件需继承自 `React.Component`
- 类组件必须实现 `render`方法
- 使用 `this.state` 维护组件内部的数据
- 当render被调用时，将检查 `this.state`和 `this.props`的变化并返回



#### render函数的返回值

| 返回值类型          | 描述                                          |
| ------------------- | --------------------------------------------- |
| **React元素**       | 通过JSX创建，DOM节点或自定义组件都为react元素 |
| **数组或fragments** | 使得render函数可以返回多个元素                |
| **portals**         | 可以渲染子节点到不同DOM子树中                 |
| 字符串或数值        | 在DOM中渲染为文本节点                         |
| 布尔值或null        | 不进行渲染                                    |



### 类组件的生命周期

![image-20210104161503203](3.react-组件化.assets/image-20210104161503203.png)

![image-20210104163837545](3.react-组件化.assets/image-20210104163837545.png)

#### 挂载阶段

——当组件实例被创建并插入 DOM 中时

**constructor()**

```js
constructor(props)
```

- 作用
  - 通过给 `this.state`赋值对象来初始化**内部state**
  - 为**事件处理函数**绑定实例 (this)
- 不初始化state 或者 不进行方法绑定，可不实现构造函数
- **不能调用 `setState()` 方法**



getDerivedStateFromProps()

```js
static getDerivedStateFromProps(props, state)
```

- 在调用 render 方法前调用，并且在初始挂载及后续更新时都被调用
- **返回一个对象来更新 state**，如果返回 null 则不更新任何内容
- 此方法无权访问组件实例



**render()**

```js
render()
```

- `render()` 方法是 class 组件中唯一必须实现的方法
- 当 `render` 被调用时，将检查 `this.props` 和 `this.state` 的变化并返回以下类型
  - **React 元素**
  - **数组或 fragments**
  - **Portals**
  - **字符串或数值类型**
  - **布尔类型或 `null`**

- `render()` 函数应为纯函数——在不修改组件 state 的情况下，每次调用时都返回相同的结果



**componentDidMount()**

```js
componentDidMount()
```

- 在组件挂载后（插入 DOM 树中）立即调用
- **使用场景**
  - 发送网络请求，获取数据
  - 添加订阅
  - 依赖于DOM的操作



#### 更新阶段

——当组件的 props 或 state 发生变化时会触发更新

getDerivedStateFromProps()



shouldComponentUpdate() 

```js
shouldComponentUpdate(nextProps, nextState)
```

- 根据 `shouldComponentUpdate()` 的返回值，是否重新执行render方法
- 默认行为： state 每次发生变化组件都会重新渲染
- 首次渲染或使用 `forceUpdate()` 时不会调用该方法



**render()**



getSnapshotBeforeUpdate()

```js
getSnapshotBeforeUpdate(prevProps, prevState)
```

- 在最近一次渲染输出（提交到 DOM 节点）之前调用
- 让组件能**在发生更改之前从 DOM 中捕获一些信息**
- 返回值将作为参数传递给 `componentDidUpdate()`



**componentDidUpdate()**

```js
componentDidUpdate(prevProps, prevState, snapshot)
```

- 在更新后会被立即调用
- 首次渲染不会执行此方法



#### 卸载阶段

**componentWillUnmount()**

```
componentWillUnmount()
```

- 在组件卸载及销毁之前直接调用
- `componentWillUnmount()` 中**不应调用 `setState()`**
- 使用场景
  - 清除 timer
  - 取消网络请求
  - 清除在 `componentDidMount()` 中创建的订阅