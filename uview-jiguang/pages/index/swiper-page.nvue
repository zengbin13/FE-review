<template>
    <view class="uni-swiper-page">
        <list ref="list" class="list" :offset-accuracy="5"  fixFreezing="true"  @loadmore="loadMoreData" loadmoreoffset="300" >
            <cell v-for="(item, index) in dataList" :key="item.id" :ref="'item'+index">
                <view class="list-item" >
                    <invite-item :inviteData="item"></invite-item>
                </view>
            </cell>
            <cell class="loading">
				<text class="loading-txt" v-if="nomore"> - â˜ƒï¸ æ²¡æœ‰æ›´å¤šäº† ğŸ”ï¸ - </text>
			</cell>
        </list>
		<view v-if="count === 0 && !firstRequest" class="empty">
			<image 
				src="@/static/images/empty/empty1.png" 
				mode="widthFix" 
				class="empty-img"></image>
			<text class="empty-txt">æ²¡æœ‰æ•°æ®</text>
		</view>
    </view>
</template>

<script>
	import service from '@/static/js/service.js';
	import utils from '@/static/js/utils.js';
	
	import inviteItem from '@/components/invite-item/invite-item';

	
    export default {
        props: {
            pid: {
                type: [Number, String],
                default: ''
            },
			areaId: {
				type: [Number, Object],
				default: 0
			},
            parentId: {
                type: [Number, String],
                default: ''
            }
        },
        data() {
            return {
                scrollable: true,
                dataList: [],
				status: 'loadmore',
				page: 1,
				count: 0,
				firstRequest: true,
            }
        },
		components:{
			inviteItem
		},
		computed:{
			nomore() {
				if(this.dataList.length === 0) return false
				return this.dataList.length >= this.count
			}
		},
        methods: {
			// é‚€çº¦æ•°æ®
			async getInviteList() {
				let params = {
					page: this.page,
					type: 1,
					cate_id: this.pid,
					areas_id: this.areaId,
					limit: 10
				};
				//è¯·æ±‚æ•°æ®
				let res = await service.index.get_invite_list(params);
				this.count = res.data.count
				this.dataList = [...this.dataList, ...res.data.data];
				this.firstRequest = false;
				console.log(this.count, this.firstRequest, res.data.data);
			},
			loadMoreData() {
				this.page++
				this.getInviteList()
			},
            setScrollRef(height) {
				// console.log(this.$refs['list']);
				// è®¾ç½®åµŒå¥—listçˆ¶å®¹å™¨æ”¯æŒswiper-listå¸é¡¶æ»šåŠ¨æ•ˆæœ
                if (this.$refs['list'] && this.$refs['list'].setSpecialEffects) {
                    this.$refs['list'].setSpecialEffects({
                        id: this.parentId,
                        headerHeight: height
                    });
                }
            },
            loadData() {
                // é¦–æ¬¡æ¿€æ´»æ—¶è¢«è°ƒç”¨
				this.getInviteList()
            },
            clear() {
                // é‡Šæ”¾æ•°æ®æ—¶è¢«è°ƒç”¨ï¼Œå‚è€ƒ swiper-list ç¼“å­˜é…ç½®
                this.dataList.length = 0;
				this.page = 1;
				this.count = 0;
				this.firstRequest = true;
            }
        }
    }
</script>

<style scoped>
    .uni-swiper-page {
        flex: 1;
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
    }

    .list {
        flex: 1;
        background-color: #ebebeb;
    }

    .list-item {
        margin-left: 12px;
        margin-right: 12px;
        margin-top: 12px;
        /* padding: 20px; */
        background-color: #fff;
        border-radius: 10px;
    }

    .loading {
        height: 25px;
    }
	.loading-txt {
		font-size: 28rpx;
		line-height: 25px;
		text-align: center;
		color: #858585;
	}
	.empty {
		width: 750rpx; 
		align-items: center;
	}
	.empty-img {
		width: 250rpx;
		margin-top: 200rpx;
	}
	.empty-txt {
		font-size: 30rpx;
		line-height: 50rpx;
		color: #858585;
	}
</style>
