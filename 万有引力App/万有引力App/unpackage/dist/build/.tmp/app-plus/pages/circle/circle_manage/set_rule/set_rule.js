(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/circle/circle_manage/set_rule/set_rule"],{"3ac2":function(e,t,i){"use strict";var n=i("f42e"),u=i.n(n);u.a},"4cff":function(e,t,i){"use strict";i.r(t);var n=i("d5b6"),u=i("f669");for(var c in u)"default"!==c&&function(e){i.d(t,e,function(){return u[e]})}(c);i("3ac2");var r,s=i("f0c5"),a=Object(s["a"])(u["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],r);t["default"]=a.exports},"5ba9":function(e,t,i){"use strict";(function(e){i("d38d"),i("921b");n(i("66fd"));var t=n(i("4cff"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("6e42")["createPage"])},9621:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=u(i("a34a"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t,i,n,u,c,r){try{var s=e[c](r),a=s.value}catch(l){return void i(l)}s.done?t(a):Promise.resolve(a).then(n,u)}function r(e){return function(){var t=this,i=arguments;return new Promise(function(n,u){var r=e.apply(t,i);function s(e){c(r,n,u,s,a,"next",e)}function a(e){c(r,n,u,s,a,"throw",e)}s(void 0)})}}var s={data:function(){return{circleId:0,circleType:0,userId:0,rule:null,list:[{title:"按月订购",desc:"/月",placeholder:"输入数字50到3000",inputValue:"",units:1,min:50,max:3e3,checked:!1},{title:"按季订购",desc:"/季",placeholder:"输入数字50到3000",inputValue:"",units:2,min:50,max:3e3,checked:!1},{title:"按年订购",desc:"/年",placeholder:"输入数字50到3000",inputValue:"",units:3,min:50,max:3e3,checked:!1}],discountChecked:!1,discountArray:[1,2,3,4,5,6,7,8,9],discountCur:9}},methods:{initRule:function(){var e=r(n.default.mark(function e(){var t,i,u,c,r;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$service.newCircleRules.list({circleId:this.circleId,userId:this.userId});case 2:if(t=e.sent,t.success)for(i=t.data.data,u=0;u<i.regulation.length;u++)c=i.regulation[u].units-1,this.list.length>c&&c>=0&&(this.list[c].checked=!0,this.list[c].id=i.regulation[u].id,this.list[c].inputValue=i.regulation[u].price),0==u&&(r=i.regulation[u].discount||0,100!=r&&0!=r&&(this.discountChecked=!0,this.discountCur=r/10));case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),payChange:function(e){this.list[e].checked=!this.list[e].checked},discountChange:function(){this.discountChecked=!this.discountChecked},discountTap:function(e){this.discountCur=e},amountInput:function(e){var t=Number(e.target.dataset.index);e.detail.value=this.$util.demicalInput(e.detail.value),this.$nextTick(function(){this.list[t].inputValue=e.detail.value})},toPay:function(){var t=r(n.default.mark(function t(){var i,u,c,r,s,a,l,o,d;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:i=[],u=100,this.discountChecked&&(u=10*this.discountCur),c=0;case 4:if(!(c<this.list.length)){t.next=24;break}if(!this.list[c].checked){t.next=21;break}if(r=this.list[c],s=r.inputValue,/^\d+(\.\d{0,6})?$/.test(s)){t.next=11;break}return this.$util.showToast("请输入正确的金额"),t.abrupt("return");case 11:if(s=Number(s),!(s<r.min)){t.next=15;break}return this.$util.showToast("当前金额不能小于"+r.min),t.abrupt("return");case 15:if(!(s>r.max)){t.next=18;break}return this.$util.showToast("当前金额不能大于"+r.max),t.abrupt("return");case 18:a={discount:u,units:r.units,price:s.toFixed(2)},r.id&&(a.id=r.id),i.push(a);case 21:c++,t.next=4;break;case 24:if(0!=i.length){t.next=27;break}return this.$util.showToast("请设置收费规则"),t.abrupt("return");case 27:if(l=JSON.stringify(i),0!=this.circleType){t.next=35;break}return t.next=31,this.$service.newCircleRules.set({circleId:this.circleId,rules:l});case 31:o=t.sent,o.success&&(this.$util.showSuccess("设置成功"),setTimeout(function(){e.navigateBack({delta:2})},800)),t.next=39;break;case 35:return t.next=37,this.$service.newCircleRules.update({circleId:this.circleId,rules:l});case 37:d=t.sent,d.success&&(this.$util.showSuccess("修改成功"),setTimeout(function(){e.navigateBack({delta:2})},800));case 39:case"end":return t.stop()}},t,this)}));function i(){return t.apply(this,arguments)}return i}()},onLoad:function(e){this.circleId=e.circleId||0,this.userId=e.userId||0,this.circleType=e.circleType?Number(e.circleType):0,this.initRule()}};t.default=s}).call(this,i("6e42")["default"])},d5b6:function(e,t,i){"use strict";var n,u=function(){var e=this,t=e.$createElement;e._self._c},c=[];i.d(t,"b",function(){return u}),i.d(t,"c",function(){return c}),i.d(t,"a",function(){return n})},f42e:function(e,t,i){},f669:function(e,t,i){"use strict";i.r(t);var n=i("9621"),u=i.n(n);for(var c in n)"default"!==c&&function(e){i.d(t,e,function(){return n[e]})}(c);t["default"]=u.a}},[["5ba9","common/runtime","common/vendor"]]]);